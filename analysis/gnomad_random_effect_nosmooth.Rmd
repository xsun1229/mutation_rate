---
title: "Cross validation for the Random effect"
author: "XSun"
date: "2023-04-05"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(data.table)
library(tidyr)
library(dplyr)
```

# Introduction

We grouped the chr22 into 100bp, 1kb, 10kb windows. In each window, we sampled 90% sites as training data, and the remaining 10% as the testing data.

Then, we 

1. computed the random effect (eff_rand) in this window using these training sites. 

2. predicted the observed number of SNV (SNV_obs_pred) with eff_rand on the testing sites in each window.

3. fit SNV_obs ~ SNV_obs_pred + 0 

# 100bp

## All 6 mutation types

```{r echo=FALSE, message=FALSE, warning=FALSE,fig.height=5, fig.width=10}

load("/project/xinhe/xsun/mutation_rate/1.exp_obs_gnomad/data_processed/chr22/cv_100bp.rdata")

combine <- merge(merged_sampled,merged_unsampled,by="window")
colnames(combine) <- c("window","sampled_sam","start_sam","end_sam","SNV_exp_sam","SNV_obs_sam","sampled_unsam","start_unsam","end_unsam","SNV_exp_unsam","SNV_obs_unsam")

eff_rand_sampled <- combine$SNV_obs_sam/combine$SNV_exp_sam

combine$SNV_pred_random <- combine$SNV_exp_unsam*eff_rand_sampled

# set up the 2x1 plot grid
par(mfrow=c(1,2))

# plot the first figure
plot(combine$SNV_pred_random, combine$SNV_obs_unsam, 
     xlab = "predicted_by_random_effect_testing_data", ylab = "observed_testing_data", 
     main = "Random Effect")
fit1 <- lm(combine$SNV_obs_unsam ~ combine$SNV_pred_random +0)
abline(fit1,col="red")
adj.rsq <-summary(fit1)$adj.r.squared
pval <- summary(fit1)$coefficients[,4]
print(paste0("Random Effect: the ajusted rsq is ",adj.rsq))
print(paste0("Random Effect: the fitting pvalue is ",pval))

# plot the second figure
plot(combine$SNV_exp_unsam, combine$SNV_obs_unsam, 
     xlab = "predicted_by_Roulette_testing_data", ylab = "observed_testing_data",
     main = "Roulette baseline")
fit2 <- lm(combine$SNV_obs_unsam ~ combine$SNV_exp_unsam +0)
abline(fit2,col="red")
adj.rsq <-summary(fit2)$adj.r.squared
pval <- summary(fit2)$coefficients[,4]
print(paste0("Roulette baseline: the ajusted rsq is ",adj.rsq))
print(paste0("Roulette baseline: the fitting pvalue is ",pval))

```

## A - G

```{r echo=FALSE, message=FALSE, warning=FALSE,fig.height=5, fig.width=10}

load("/project/xinhe/xsun/mutation_rate/1.exp_obs_gnomad/data_processed/chr22/cv_ag_100bp.rdata")

combine <- merge(merged_sampled,merged_unsampled,by="window")
colnames(combine) <- c("window","sampled_sam","start_sam","end_sam","SNV_exp_sam","SNV_obs_sam","sampled_unsam","start_unsam","end_unsam","SNV_exp_unsam","SNV_obs_unsam")

eff_rand_sampled <- combine$SNV_obs_sam/combine$SNV_exp_sam

combine$SNV_pred_random <- combine$SNV_exp_unsam*eff_rand_sampled

# set up the 2x1 plot grid
par(mfrow=c(1,2))

# plot the first figure
plot(combine$SNV_pred_random, combine$SNV_obs_unsam, 
     xlab = "predicted_by_random_effect_testing_data", ylab = "observed_testing_data", 
     main = "Random Effect")
fit1 <- lm(combine$SNV_obs_unsam ~ combine$SNV_pred_random +0)
abline(fit1,col="red")
adj.rsq <-summary(fit1)$adj.r.squared
pval <- summary(fit1)$coefficients[,4]
print(paste0("Random Effect: the ajusted rsq is ",adj.rsq))
print(paste0("Random Effect: the fitting pvalue is ",pval))

# plot the second figure
plot(combine$SNV_exp_unsam, combine$SNV_obs_unsam, 
     xlab = "predicted_by_Roulette_testing_data", ylab = "observed_testing_data",
     main = "Roulette baseline")
fit2 <- lm(combine$SNV_obs_unsam ~ combine$SNV_exp_unsam +0)
abline(fit2,col="red")
adj.rsq <-summary(fit2)$adj.r.squared
pval <- summary(fit2)$coefficients[,4]
print(paste0("Roulette baseline: the ajusted rsq is ",adj.rsq))
print(paste0("Roulette baseline: the fitting pvalue is ",pval))

```


## A - C
```{r echo=FALSE, message=FALSE, warning=FALSE,fig.height=5, fig.width=10}

load("/project/xinhe/xsun/mutation_rate/1.exp_obs_gnomad/data_processed/chr22/cv_ac_100bp.rdata")

combine <- merge(merged_sampled,merged_unsampled,by="window")
colnames(combine) <- c("window","sampled_sam","start_sam","end_sam","SNV_exp_sam","SNV_obs_sam","sampled_unsam","start_unsam","end_unsam","SNV_exp_unsam","SNV_obs_unsam")

eff_rand_sampled <- combine$SNV_obs_sam/combine$SNV_exp_sam

combine$SNV_pred_random <- combine$SNV_exp_unsam*eff_rand_sampled

# set up the 2x1 plot grid
par(mfrow=c(1,2))

# plot the first figure
plot(combine$SNV_pred_random, combine$SNV_obs_unsam, 
     xlab = "predicted_by_random_effect_testing_data", ylab = "observed_testing_data", 
     main = "Random Effect")
fit1 <- lm(combine$SNV_obs_unsam ~ combine$SNV_pred_random +0)
abline(fit1,col="red")
adj.rsq <-summary(fit1)$adj.r.squared
pval <- summary(fit1)$coefficients[,4]
print(paste0("Random Effect: the ajusted rsq is ",adj.rsq))
print(paste0("Random Effect: the fitting pvalue is ",pval))

# plot the second figure
plot(combine$SNV_exp_unsam, combine$SNV_obs_unsam, 
     xlab = "predicted_by_Roulette_testing_data", ylab = "observed_testing_data",
     main = "Roulette baseline")
fit2 <- lm(combine$SNV_obs_unsam ~ combine$SNV_exp_unsam +0)
abline(fit2,col="red")
adj.rsq <-summary(fit2)$adj.r.squared
pval <- summary(fit2)$coefficients[,4]
print(paste0("Roulette baseline: the ajusted rsq is ",adj.rsq))
print(paste0("Roulette baseline: the fitting pvalue is ",pval))

```
## A - T
```{r echo=FALSE, message=FALSE, warning=FALSE,fig.height=5, fig.width=10}

load("/project/xinhe/xsun/mutation_rate/1.exp_obs_gnomad/data_processed/chr22/cv_at_100bp.rdata")

combine <- merge(merged_sampled,merged_unsampled,by="window")
colnames(combine) <- c("window","sampled_sam","start_sam","end_sam","SNV_exp_sam","SNV_obs_sam","sampled_unsam","start_unsam","end_unsam","SNV_exp_unsam","SNV_obs_unsam")

eff_rand_sampled <- combine$SNV_obs_sam/combine$SNV_exp_sam

combine$SNV_pred_random <- combine$SNV_exp_unsam*eff_rand_sampled

# set up the 2x1 plot grid
par(mfrow=c(1,2))

# plot the first figure
plot(combine$SNV_pred_random, combine$SNV_obs_unsam, 
     xlab = "predicted_by_random_effect_testing_data", ylab = "observed_testing_data", 
     main = "Random Effect")
fit1 <- lm(combine$SNV_obs_unsam ~ combine$SNV_pred_random +0)
abline(fit1,col="red")
adj.rsq <-summary(fit1)$adj.r.squared
pval <- summary(fit1)$coefficients[,4]
print(paste0("Random Effect: the ajusted rsq is ",adj.rsq))
print(paste0("Random Effect: the fitting pvalue is ",pval))

# plot the second figure
plot(combine$SNV_exp_unsam, combine$SNV_obs_unsam, 
     xlab = "predicted_by_Roulette_testing_data", ylab = "observed_testing_data",
     main = "Roulette baseline")
fit2 <- lm(combine$SNV_obs_unsam ~ combine$SNV_exp_unsam +0)
abline(fit2,col="red")
adj.rsq <-summary(fit2)$adj.r.squared
pval <- summary(fit2)$coefficients[,4]
print(paste0("Roulette baseline: the ajusted rsq is ",adj.rsq))
print(paste0("Roulette baseline: the fitting pvalue is ",pval))

```
## C - A
```{r echo=FALSE, message=FALSE, warning=FALSE,fig.height=5, fig.width=10}

load("/project/xinhe/xsun/mutation_rate/1.exp_obs_gnomad/data_processed/chr22/cv_ca_100bp.rdata")

combine <- merge(merged_sampled,merged_unsampled,by="window")
colnames(combine) <- c("window","sampled_sam","start_sam","end_sam","SNV_exp_sam","SNV_obs_sam","sampled_unsam","start_unsam","end_unsam","SNV_exp_unsam","SNV_obs_unsam")

eff_rand_sampled <- combine$SNV_obs_sam/combine$SNV_exp_sam

combine$SNV_pred_random <- combine$SNV_exp_unsam*eff_rand_sampled

# set up the 2x1 plot grid
par(mfrow=c(1,2))

# plot the first figure
plot(combine$SNV_pred_random, combine$SNV_obs_unsam, 
     xlab = "predicted_by_random_effect_testing_data", ylab = "observed_testing_data", 
     main = "Random Effect")
fit1 <- lm(combine$SNV_obs_unsam ~ combine$SNV_pred_random +0)
abline(fit1,col="red")
adj.rsq <-summary(fit1)$adj.r.squared
pval <- summary(fit1)$coefficients[,4]
print(paste0("Random Effect: the ajusted rsq is ",adj.rsq))
print(paste0("Random Effect: the fitting pvalue is ",pval))

# plot the second figure
plot(combine$SNV_exp_unsam, combine$SNV_obs_unsam, 
     xlab = "predicted_by_Roulette_testing_data", ylab = "observed_testing_data",
     main = "Roulette baseline")
fit2 <- lm(combine$SNV_obs_unsam ~ combine$SNV_exp_unsam +0)
abline(fit2,col="red")
adj.rsq <-summary(fit2)$adj.r.squared
pval <- summary(fit2)$coefficients[,4]
print(paste0("Roulette baseline: the ajusted rsq is ",adj.rsq))
print(paste0("Roulette baseline: the fitting pvalue is ",pval))

```
## C - G
```{r echo=FALSE, message=FALSE, warning=FALSE,fig.height=5, fig.width=10}

load("/project/xinhe/xsun/mutation_rate/1.exp_obs_gnomad/data_processed/chr22/cv_cg_100bp.rdata")

combine <- merge(merged_sampled,merged_unsampled,by="window")
colnames(combine) <- c("window","sampled_sam","start_sam","end_sam","SNV_exp_sam","SNV_obs_sam","sampled_unsam","start_unsam","end_unsam","SNV_exp_unsam","SNV_obs_unsam")

eff_rand_sampled <- combine$SNV_obs_sam/combine$SNV_exp_sam

combine$SNV_pred_random <- combine$SNV_exp_unsam*eff_rand_sampled

# set up the 2x1 plot grid
par(mfrow=c(1,2))

# plot the first figure
plot(combine$SNV_pred_random, combine$SNV_obs_unsam, 
     xlab = "predicted_by_random_effect_testing_data", ylab = "observed_testing_data", 
     main = "Random Effect")
fit1 <- lm(combine$SNV_obs_unsam ~ combine$SNV_pred_random +0)
abline(fit1,col="red")
adj.rsq <-summary(fit1)$adj.r.squared
pval <- summary(fit1)$coefficients[,4]
print(paste0("Random Effect: the ajusted rsq is ",adj.rsq))
print(paste0("Random Effect: the fitting pvalue is ",pval))

# plot the second figure
plot(combine$SNV_exp_unsam, combine$SNV_obs_unsam, 
     xlab = "predicted_by_Roulette_testing_data", ylab = "observed_testing_data",
     main = "Roulette baseline")
fit2 <- lm(combine$SNV_obs_unsam ~ combine$SNV_exp_unsam +0)
abline(fit2,col="red")
adj.rsq <-summary(fit2)$adj.r.squared
pval <- summary(fit2)$coefficients[,4]
print(paste0("Roulette baseline: the ajusted rsq is ",adj.rsq))
print(paste0("Roulette baseline: the fitting pvalue is ",pval))

```
## C - T

```{r echo=FALSE, message=FALSE, warning=FALSE,fig.height=5, fig.width=10}

load("/project/xinhe/xsun/mutation_rate/1.exp_obs_gnomad/data_processed/chr22/cv_ct_100bp.rdata")

combine <- merge(merged_sampled,merged_unsampled,by="window")
colnames(combine) <- c("window","sampled_sam","start_sam","end_sam","SNV_exp_sam","SNV_obs_sam","sampled_unsam","start_unsam","end_unsam","SNV_exp_unsam","SNV_obs_unsam")

eff_rand_sampled <- combine$SNV_obs_sam/combine$SNV_exp_sam

combine$SNV_pred_random <- combine$SNV_exp_unsam*eff_rand_sampled

# set up the 2x1 plot grid
par(mfrow=c(1,2))

# plot the first figure
plot(combine$SNV_pred_random, combine$SNV_obs_unsam, 
     xlab = "predicted_by_random_effect_testing_data", ylab = "observed_testing_data", 
     main = "Random Effect")
fit1 <- lm(combine$SNV_obs_unsam ~ combine$SNV_pred_random +0)
abline(fit1,col="red")
adj.rsq <-summary(fit1)$adj.r.squared
pval <- summary(fit1)$coefficients[,4]
print(paste0("Random Effect: the ajusted rsq is ",adj.rsq))
print(paste0("Random Effect: the fitting pvalue is ",pval))

# plot the second figure
plot(combine$SNV_exp_unsam, combine$SNV_obs_unsam, 
     xlab = "predicted_by_Roulette_testing_data", ylab = "observed_testing_data",
     main = "Roulette baseline")
fit2 <- lm(combine$SNV_obs_unsam ~ combine$SNV_exp_unsam +0)
abline(fit2,col="red")
adj.rsq <-summary(fit2)$adj.r.squared
pval <- summary(fit2)$coefficients[,4]
print(paste0("Roulette baseline: the ajusted rsq is ",adj.rsq))
print(paste0("Roulette baseline: the fitting pvalue is ",pval))

```




# 1kb

## All 6 mutation types

```{r echo=FALSE, message=FALSE, warning=FALSE,fig.height=5, fig.width=10}

load("/project/xinhe/xsun/mutation_rate/1.exp_obs_gnomad/data_processed/chr22/cv_1kb.rdata")

combine <- merge(merged_sampled,merged_unsampled,by="window")
colnames(combine) <- c("window","sampled_sam","start_sam","end_sam","SNV_exp_sam","SNV_obs_sam","sampled_unsam","start_unsam","end_unsam","SNV_exp_unsam","SNV_obs_unsam")

eff_rand_sampled <- combine$SNV_obs_sam/combine$SNV_exp_sam

combine$SNV_pred_random <- combine$SNV_exp_unsam*eff_rand_sampled

# set up the 2x1 plot grid
par(mfrow=c(1,2))

# plot the first figure
plot(combine$SNV_pred_random, combine$SNV_obs_unsam, 
     xlab = "predicted_by_random_effect_testing_data", ylab = "observed_testing_data", 
     main = "Random Effect")
fit1 <- lm(combine$SNV_obs_unsam ~ combine$SNV_pred_random +0)
abline(fit1,col="red")
adj.rsq <-summary(fit1)$adj.r.squared
pval <- summary(fit1)$coefficients[,4]
print(paste0("Random Effect: the ajusted rsq is ",adj.rsq))
print(paste0("Random Effect: the fitting pvalue is ",pval))

# plot the second figure
plot(combine$SNV_exp_unsam, combine$SNV_obs_unsam, 
     xlab = "predicted_by_Roulette_testing_data", ylab = "observed_testing_data",
     main = "Roulette baseline")
fit2 <- lm(combine$SNV_obs_unsam ~ combine$SNV_exp_unsam +0)
abline(fit2,col="red")
adj.rsq <-summary(fit2)$adj.r.squared
pval <- summary(fit2)$coefficients[,4]
print(paste0("Roulette baseline: the ajusted rsq is ",adj.rsq))
print(paste0("Roulette baseline: the fitting pvalue is ",pval))

```

## A - G

```{r echo=FALSE, message=FALSE, warning=FALSE,fig.height=5, fig.width=10}

load("/project/xinhe/xsun/mutation_rate/1.exp_obs_gnomad/data_processed/chr22/cv_ag_1kb.rdata")

combine <- merge(merged_sampled,merged_unsampled,by="window")
colnames(combine) <- c("window","sampled_sam","start_sam","end_sam","SNV_exp_sam","SNV_obs_sam","sampled_unsam","start_unsam","end_unsam","SNV_exp_unsam","SNV_obs_unsam")

eff_rand_sampled <- combine$SNV_obs_sam/combine$SNV_exp_sam

combine$SNV_pred_random <- combine$SNV_exp_unsam*eff_rand_sampled

# set up the 2x1 plot grid
par(mfrow=c(1,2))

# plot the first figure
plot(combine$SNV_pred_random, combine$SNV_obs_unsam, 
     xlab = "predicted_by_random_effect_testing_data", ylab = "observed_testing_data", 
     main = "Random Effect")
fit1 <- lm(combine$SNV_obs_unsam ~ combine$SNV_pred_random +0)
abline(fit1,col="red")
adj.rsq <-summary(fit1)$adj.r.squared
pval <- summary(fit1)$coefficients[,4]
print(paste0("Random Effect: the ajusted rsq is ",adj.rsq))
print(paste0("Random Effect: the fitting pvalue is ",pval))

# plot the second figure
plot(combine$SNV_exp_unsam, combine$SNV_obs_unsam, 
     xlab = "predicted_by_Roulette_testing_data", ylab = "observed_testing_data",
     main = "Roulette baseline")
fit2 <- lm(combine$SNV_obs_unsam ~ combine$SNV_exp_unsam +0)
abline(fit2,col="red")
adj.rsq <-summary(fit2)$adj.r.squared
pval <- summary(fit2)$coefficients[,4]
print(paste0("Roulette baseline: the ajusted rsq is ",adj.rsq))
print(paste0("Roulette baseline: the fitting pvalue is ",pval))

```


## A - C
```{r echo=FALSE, message=FALSE, warning=FALSE,fig.height=5, fig.width=10}

load("/project/xinhe/xsun/mutation_rate/1.exp_obs_gnomad/data_processed/chr22/cv_ac_1kb.rdata")

combine <- merge(merged_sampled,merged_unsampled,by="window")
colnames(combine) <- c("window","sampled_sam","start_sam","end_sam","SNV_exp_sam","SNV_obs_sam","sampled_unsam","start_unsam","end_unsam","SNV_exp_unsam","SNV_obs_unsam")

eff_rand_sampled <- combine$SNV_obs_sam/combine$SNV_exp_sam

combine$SNV_pred_random <- combine$SNV_exp_unsam*eff_rand_sampled

# set up the 2x1 plot grid
par(mfrow=c(1,2))

# plot the first figure
plot(combine$SNV_pred_random, combine$SNV_obs_unsam, 
     xlab = "predicted_by_random_effect_testing_data", ylab = "observed_testing_data", 
     main = "Random Effect")
fit1 <- lm(combine$SNV_obs_unsam ~ combine$SNV_pred_random +0)
abline(fit1,col="red")
adj.rsq <-summary(fit1)$adj.r.squared
pval <- summary(fit1)$coefficients[,4]
print(paste0("Random Effect: the ajusted rsq is ",adj.rsq))
print(paste0("Random Effect: the fitting pvalue is ",pval))

# plot the second figure
plot(combine$SNV_exp_unsam, combine$SNV_obs_unsam, 
     xlab = "predicted_by_Roulette_testing_data", ylab = "observed_testing_data",
     main = "Roulette baseline")
fit2 <- lm(combine$SNV_obs_unsam ~ combine$SNV_exp_unsam +0)
abline(fit2,col="red")
adj.rsq <-summary(fit2)$adj.r.squared
pval <- summary(fit2)$coefficients[,4]
print(paste0("Roulette baseline: the ajusted rsq is ",adj.rsq))
print(paste0("Roulette baseline: the fitting pvalue is ",pval))

```
## A - T
```{r echo=FALSE, message=FALSE, warning=FALSE,fig.height=5, fig.width=10}

load("/project/xinhe/xsun/mutation_rate/1.exp_obs_gnomad/data_processed/chr22/cv_at_1kb.rdata")

combine <- merge(merged_sampled,merged_unsampled,by="window")
colnames(combine) <- c("window","sampled_sam","start_sam","end_sam","SNV_exp_sam","SNV_obs_sam","sampled_unsam","start_unsam","end_unsam","SNV_exp_unsam","SNV_obs_unsam")

eff_rand_sampled <- combine$SNV_obs_sam/combine$SNV_exp_sam

combine$SNV_pred_random <- combine$SNV_exp_unsam*eff_rand_sampled

# set up the 2x1 plot grid
par(mfrow=c(1,2))

# plot the first figure
plot(combine$SNV_pred_random, combine$SNV_obs_unsam, 
     xlab = "predicted_by_random_effect_testing_data", ylab = "observed_testing_data", 
     main = "Random Effect")
fit1 <- lm(combine$SNV_obs_unsam ~ combine$SNV_pred_random +0)
abline(fit1,col="red")
adj.rsq <-summary(fit1)$adj.r.squared
pval <- summary(fit1)$coefficients[,4]
print(paste0("Random Effect: the ajusted rsq is ",adj.rsq))
print(paste0("Random Effect: the fitting pvalue is ",pval))

# plot the second figure
plot(combine$SNV_exp_unsam, combine$SNV_obs_unsam, 
     xlab = "predicted_by_Roulette_testing_data", ylab = "observed_testing_data",
     main = "Roulette baseline")
fit2 <- lm(combine$SNV_obs_unsam ~ combine$SNV_exp_unsam +0)
abline(fit2,col="red")
adj.rsq <-summary(fit2)$adj.r.squared
pval <- summary(fit2)$coefficients[,4]
print(paste0("Roulette baseline: the ajusted rsq is ",adj.rsq))
print(paste0("Roulette baseline: the fitting pvalue is ",pval))

```
## C - A
```{r echo=FALSE, message=FALSE, warning=FALSE,fig.height=5, fig.width=10}

load("/project/xinhe/xsun/mutation_rate/1.exp_obs_gnomad/data_processed/chr22/cv_ca_1kb.rdata")

combine <- merge(merged_sampled,merged_unsampled,by="window")
colnames(combine) <- c("window","sampled_sam","start_sam","end_sam","SNV_exp_sam","SNV_obs_sam","sampled_unsam","start_unsam","end_unsam","SNV_exp_unsam","SNV_obs_unsam")

eff_rand_sampled <- combine$SNV_obs_sam/combine$SNV_exp_sam

combine$SNV_pred_random <- combine$SNV_exp_unsam*eff_rand_sampled

# set up the 2x1 plot grid
par(mfrow=c(1,2))

# plot the first figure
plot(combine$SNV_pred_random, combine$SNV_obs_unsam, 
     xlab = "predicted_by_random_effect_testing_data", ylab = "observed_testing_data", 
     main = "Random Effect")
fit1 <- lm(combine$SNV_obs_unsam ~ combine$SNV_pred_random +0)
abline(fit1,col="red")
adj.rsq <-summary(fit1)$adj.r.squared
pval <- summary(fit1)$coefficients[,4]
print(paste0("Random Effect: the ajusted rsq is ",adj.rsq))
print(paste0("Random Effect: the fitting pvalue is ",pval))

# plot the second figure
plot(combine$SNV_exp_unsam, combine$SNV_obs_unsam, 
     xlab = "predicted_by_Roulette_testing_data", ylab = "observed_testing_data",
     main = "Roulette baseline")
fit2 <- lm(combine$SNV_obs_unsam ~ combine$SNV_exp_unsam +0)
abline(fit2,col="red")
adj.rsq <-summary(fit2)$adj.r.squared
pval <- summary(fit2)$coefficients[,4]
print(paste0("Roulette baseline: the ajusted rsq is ",adj.rsq))
print(paste0("Roulette baseline: the fitting pvalue is ",pval))

```
## C - G
```{r echo=FALSE, message=FALSE, warning=FALSE,fig.height=5, fig.width=10}

load("/project/xinhe/xsun/mutation_rate/1.exp_obs_gnomad/data_processed/chr22/cv_cg_1kb.rdata")

combine <- merge(merged_sampled,merged_unsampled,by="window")
colnames(combine) <- c("window","sampled_sam","start_sam","end_sam","SNV_exp_sam","SNV_obs_sam","sampled_unsam","start_unsam","end_unsam","SNV_exp_unsam","SNV_obs_unsam")

eff_rand_sampled <- combine$SNV_obs_sam/combine$SNV_exp_sam

combine$SNV_pred_random <- combine$SNV_exp_unsam*eff_rand_sampled

# set up the 2x1 plot grid
par(mfrow=c(1,2))

# plot the first figure
plot(combine$SNV_pred_random, combine$SNV_obs_unsam, 
     xlab = "predicted_by_random_effect_testing_data", ylab = "observed_testing_data", 
     main = "Random Effect")
fit1 <- lm(combine$SNV_obs_unsam ~ combine$SNV_pred_random +0)
abline(fit1,col="red")
adj.rsq <-summary(fit1)$adj.r.squared
pval <- summary(fit1)$coefficients[,4]
print(paste0("Random Effect: the ajusted rsq is ",adj.rsq))
print(paste0("Random Effect: the fitting pvalue is ",pval))

# plot the second figure
plot(combine$SNV_exp_unsam, combine$SNV_obs_unsam, 
     xlab = "predicted_by_Roulette_testing_data", ylab = "observed_testing_data",
     main = "Roulette baseline")
fit2 <- lm(combine$SNV_obs_unsam ~ combine$SNV_exp_unsam +0)
abline(fit2,col="red")
adj.rsq <-summary(fit2)$adj.r.squared
pval <- summary(fit2)$coefficients[,4]
print(paste0("Roulette baseline: the ajusted rsq is ",adj.rsq))
print(paste0("Roulette baseline: the fitting pvalue is ",pval))

```
## C - T

```{r echo=FALSE, message=FALSE, warning=FALSE,fig.height=5, fig.width=10}

load("/project/xinhe/xsun/mutation_rate/1.exp_obs_gnomad/data_processed/chr22/cv_ct_1kb.rdata")

combine <- merge(merged_sampled,merged_unsampled,by="window")
colnames(combine) <- c("window","sampled_sam","start_sam","end_sam","SNV_exp_sam","SNV_obs_sam","sampled_unsam","start_unsam","end_unsam","SNV_exp_unsam","SNV_obs_unsam")

eff_rand_sampled <- combine$SNV_obs_sam/combine$SNV_exp_sam

combine$SNV_pred_random <- combine$SNV_exp_unsam*eff_rand_sampled

# set up the 2x1 plot grid
par(mfrow=c(1,2))

# plot the first figure
plot(combine$SNV_pred_random, combine$SNV_obs_unsam, 
     xlab = "predicted_by_random_effect_testing_data", ylab = "observed_testing_data", 
     main = "Random Effect")
fit1 <- lm(combine$SNV_obs_unsam ~ combine$SNV_pred_random +0)
abline(fit1,col="red")
adj.rsq <-summary(fit1)$adj.r.squared
pval <- summary(fit1)$coefficients[,4]
print(paste0("Random Effect: the ajusted rsq is ",adj.rsq))
print(paste0("Random Effect: the fitting pvalue is ",pval))

# plot the second figure
plot(combine$SNV_exp_unsam, combine$SNV_obs_unsam, 
     xlab = "predicted_by_Roulette_testing_data", ylab = "observed_testing_data",
     main = "Roulette baseline")
fit2 <- lm(combine$SNV_obs_unsam ~ combine$SNV_exp_unsam +0)
abline(fit2,col="red")
adj.rsq <-summary(fit2)$adj.r.squared
pval <- summary(fit2)$coefficients[,4]
print(paste0("Roulette baseline: the ajusted rsq is ",adj.rsq))
print(paste0("Roulette baseline: the fitting pvalue is ",pval))

```

# 10kb

## All 6 mutation types

```{r echo=FALSE, message=FALSE, warning=FALSE,fig.height=5, fig.width=10}

load("/project/xinhe/xsun/mutation_rate/1.exp_obs_gnomad/data_processed/chr22/cv_10kb.rdata")

combine <- merge(merged_sampled,merged_unsampled,by="window")
colnames(combine) <- c("window","sampled_sam","start_sam","end_sam","SNV_exp_sam","SNV_obs_sam","sampled_unsam","start_unsam","end_unsam","SNV_exp_unsam","SNV_obs_unsam")

eff_rand_sampled <- combine$SNV_obs_sam/combine$SNV_exp_sam

combine$SNV_pred_random <- combine$SNV_exp_unsam*eff_rand_sampled

# set up the 2x1 plot grid
par(mfrow=c(1,2))

# plot the first figure
plot(combine$SNV_pred_random, combine$SNV_obs_unsam, 
     xlab = "predicted_by_random_effect_testing_data", ylab = "observed_testing_data", 
     main = "Random Effect")
fit1 <- lm(combine$SNV_obs_unsam ~ combine$SNV_pred_random +0)
abline(fit1,col="red")
adj.rsq <-summary(fit1)$adj.r.squared
pval <- summary(fit1)$coefficients[,4]
print(paste0("Random Effect: the ajusted rsq is ",adj.rsq))
print(paste0("Random Effect: the fitting pvalue is ",pval))

# plot the second figure
plot(combine$SNV_exp_unsam, combine$SNV_obs_unsam, 
     xlab = "predicted_by_Roulette_testing_data", ylab = "observed_testing_data",
     main = "Roulette baseline")
fit2 <- lm(combine$SNV_obs_unsam ~ combine$SNV_exp_unsam +0)
abline(fit2,col="red")
adj.rsq <-summary(fit2)$adj.r.squared
pval <- summary(fit2)$coefficients[,4]
print(paste0("Roulette baseline: the ajusted rsq is ",adj.rsq))
print(paste0("Roulette baseline: the fitting pvalue is ",pval))

```

## A - G

```{r echo=FALSE, message=FALSE, warning=FALSE,fig.height=5, fig.width=10}

load("/project/xinhe/xsun/mutation_rate/1.exp_obs_gnomad/data_processed/chr22/cv_ag_10kb.rdata")

combine <- merge(merged_sampled,merged_unsampled,by="window")
colnames(combine) <- c("window","sampled_sam","start_sam","end_sam","SNV_exp_sam","SNV_obs_sam","sampled_unsam","start_unsam","end_unsam","SNV_exp_unsam","SNV_obs_unsam")

eff_rand_sampled <- combine$SNV_obs_sam/combine$SNV_exp_sam

combine$SNV_pred_random <- combine$SNV_exp_unsam*eff_rand_sampled

# set up the 2x1 plot grid
par(mfrow=c(1,2))

# plot the first figure
plot(combine$SNV_pred_random, combine$SNV_obs_unsam, 
     xlab = "predicted_by_random_effect_testing_data", ylab = "observed_testing_data", 
     main = "Random Effect")
fit1 <- lm(combine$SNV_obs_unsam ~ combine$SNV_pred_random +0)
abline(fit1,col="red")
adj.rsq <-summary(fit1)$adj.r.squared
pval <- summary(fit1)$coefficients[,4]
print(paste0("Random Effect: the ajusted rsq is ",adj.rsq))
print(paste0("Random Effect: the fitting pvalue is ",pval))

# plot the second figure
plot(combine$SNV_exp_unsam, combine$SNV_obs_unsam, 
     xlab = "predicted_by_Roulette_testing_data", ylab = "observed_testing_data",
     main = "Roulette baseline")
fit2 <- lm(combine$SNV_obs_unsam ~ combine$SNV_exp_unsam +0)
abline(fit2,col="red")
adj.rsq <-summary(fit2)$adj.r.squared
pval <- summary(fit2)$coefficients[,4]
print(paste0("Roulette baseline: the ajusted rsq is ",adj.rsq))
print(paste0("Roulette baseline: the fitting pvalue is ",pval))

```


## A - C
```{r echo=FALSE, message=FALSE, warning=FALSE,fig.height=5, fig.width=10}

load("/project/xinhe/xsun/mutation_rate/1.exp_obs_gnomad/data_processed/chr22/cv_ac_10kb.rdata")

combine <- merge(merged_sampled,merged_unsampled,by="window")
colnames(combine) <- c("window","sampled_sam","start_sam","end_sam","SNV_exp_sam","SNV_obs_sam","sampled_unsam","start_unsam","end_unsam","SNV_exp_unsam","SNV_obs_unsam")

eff_rand_sampled <- combine$SNV_obs_sam/combine$SNV_exp_sam

combine$SNV_pred_random <- combine$SNV_exp_unsam*eff_rand_sampled

# set up the 2x1 plot grid
par(mfrow=c(1,2))

# plot the first figure
plot(combine$SNV_pred_random, combine$SNV_obs_unsam, 
     xlab = "predicted_by_random_effect_testing_data", ylab = "observed_testing_data", 
     main = "Random Effect")
fit1 <- lm(combine$SNV_obs_unsam ~ combine$SNV_pred_random +0)
abline(fit1,col="red")
adj.rsq <-summary(fit1)$adj.r.squared
pval <- summary(fit1)$coefficients[,4]
print(paste0("Random Effect: the ajusted rsq is ",adj.rsq))
print(paste0("Random Effect: the fitting pvalue is ",pval))

# plot the second figure
plot(combine$SNV_exp_unsam, combine$SNV_obs_unsam, 
     xlab = "predicted_by_Roulette_testing_data", ylab = "observed_testing_data",
     main = "Roulette baseline")
fit2 <- lm(combine$SNV_obs_unsam ~ combine$SNV_exp_unsam +0)
abline(fit2,col="red")
adj.rsq <-summary(fit2)$adj.r.squared
pval <- summary(fit2)$coefficients[,4]
print(paste0("Roulette baseline: the ajusted rsq is ",adj.rsq))
print(paste0("Roulette baseline: the fitting pvalue is ",pval))

```
## A - T
```{r echo=FALSE, message=FALSE, warning=FALSE,fig.height=5, fig.width=10}

load("/project/xinhe/xsun/mutation_rate/1.exp_obs_gnomad/data_processed/chr22/cv_at_10kb.rdata")

combine <- merge(merged_sampled,merged_unsampled,by="window")
colnames(combine) <- c("window","sampled_sam","start_sam","end_sam","SNV_exp_sam","SNV_obs_sam","sampled_unsam","start_unsam","end_unsam","SNV_exp_unsam","SNV_obs_unsam")

eff_rand_sampled <- combine$SNV_obs_sam/combine$SNV_exp_sam

combine$SNV_pred_random <- combine$SNV_exp_unsam*eff_rand_sampled

# set up the 2x1 plot grid
par(mfrow=c(1,2))

# plot the first figure
plot(combine$SNV_pred_random, combine$SNV_obs_unsam, 
     xlab = "predicted_by_random_effect_testing_data", ylab = "observed_testing_data", 
     main = "Random Effect")
fit1 <- lm(combine$SNV_obs_unsam ~ combine$SNV_pred_random +0)
abline(fit1,col="red")
adj.rsq <-summary(fit1)$adj.r.squared
pval <- summary(fit1)$coefficients[,4]
print(paste0("Random Effect: the ajusted rsq is ",adj.rsq))
print(paste0("Random Effect: the fitting pvalue is ",pval))

# plot the second figure
plot(combine$SNV_exp_unsam, combine$SNV_obs_unsam, 
     xlab = "predicted_by_Roulette_testing_data", ylab = "observed_testing_data",
     main = "Roulette baseline")
fit2 <- lm(combine$SNV_obs_unsam ~ combine$SNV_exp_unsam +0)
abline(fit2,col="red")
adj.rsq <-summary(fit2)$adj.r.squared
pval <- summary(fit2)$coefficients[,4]
print(paste0("Roulette baseline: the ajusted rsq is ",adj.rsq))
print(paste0("Roulette baseline: the fitting pvalue is ",pval))

```
## C - A
```{r echo=FALSE, message=FALSE, warning=FALSE,fig.height=5, fig.width=10}

load("/project/xinhe/xsun/mutation_rate/1.exp_obs_gnomad/data_processed/chr22/cv_ca_10kb.rdata")

combine <- merge(merged_sampled,merged_unsampled,by="window")
colnames(combine) <- c("window","sampled_sam","start_sam","end_sam","SNV_exp_sam","SNV_obs_sam","sampled_unsam","start_unsam","end_unsam","SNV_exp_unsam","SNV_obs_unsam")

eff_rand_sampled <- combine$SNV_obs_sam/combine$SNV_exp_sam

combine$SNV_pred_random <- combine$SNV_exp_unsam*eff_rand_sampled

# set up the 2x1 plot grid
par(mfrow=c(1,2))

# plot the first figure
plot(combine$SNV_pred_random, combine$SNV_obs_unsam, 
     xlab = "predicted_by_random_effect_testing_data", ylab = "observed_testing_data", 
     main = "Random Effect")
fit1 <- lm(combine$SNV_obs_unsam ~ combine$SNV_pred_random +0)
abline(fit1,col="red")
adj.rsq <-summary(fit1)$adj.r.squared
pval <- summary(fit1)$coefficients[,4]
print(paste0("Random Effect: the ajusted rsq is ",adj.rsq))
print(paste0("Random Effect: the fitting pvalue is ",pval))

# plot the second figure
plot(combine$SNV_exp_unsam, combine$SNV_obs_unsam, 
     xlab = "predicted_by_Roulette_testing_data", ylab = "observed_testing_data",
     main = "Roulette baseline")
fit2 <- lm(combine$SNV_obs_unsam ~ combine$SNV_exp_unsam +0)
abline(fit2,col="red")
adj.rsq <-summary(fit2)$adj.r.squared
pval <- summary(fit2)$coefficients[,4]
print(paste0("Roulette baseline: the ajusted rsq is ",adj.rsq))
print(paste0("Roulette baseline: the fitting pvalue is ",pval))

```
## C - G
```{r echo=FALSE, message=FALSE, warning=FALSE,fig.height=5, fig.width=10}

load("/project/xinhe/xsun/mutation_rate/1.exp_obs_gnomad/data_processed/chr22/cv_cg_10kb.rdata")

combine <- merge(merged_sampled,merged_unsampled,by="window")
colnames(combine) <- c("window","sampled_sam","start_sam","end_sam","SNV_exp_sam","SNV_obs_sam","sampled_unsam","start_unsam","end_unsam","SNV_exp_unsam","SNV_obs_unsam")

eff_rand_sampled <- combine$SNV_obs_sam/combine$SNV_exp_sam

combine$SNV_pred_random <- combine$SNV_exp_unsam*eff_rand_sampled

# set up the 2x1 plot grid
par(mfrow=c(1,2))

# plot the first figure
plot(combine$SNV_pred_random, combine$SNV_obs_unsam, 
     xlab = "predicted_by_random_effect_testing_data", ylab = "observed_testing_data", 
     main = "Random Effect")
fit1 <- lm(combine$SNV_obs_unsam ~ combine$SNV_pred_random +0)
abline(fit1,col="red")
adj.rsq <-summary(fit1)$adj.r.squared
pval <- summary(fit1)$coefficients[,4]
print(paste0("Random Effect: the ajusted rsq is ",adj.rsq))
print(paste0("Random Effect: the fitting pvalue is ",pval))

# plot the second figure
plot(combine$SNV_exp_unsam, combine$SNV_obs_unsam, 
     xlab = "predicted_by_Roulette_testing_data", ylab = "observed_testing_data",
     main = "Roulette baseline")
fit2 <- lm(combine$SNV_obs_unsam ~ combine$SNV_exp_unsam +0)
abline(fit2,col="red")
adj.rsq <-summary(fit2)$adj.r.squared
pval <- summary(fit2)$coefficients[,4]
print(paste0("Roulette baseline: the ajusted rsq is ",adj.rsq))
print(paste0("Roulette baseline: the fitting pvalue is ",pval))

```
## C - T

```{r echo=FALSE, message=FALSE, warning=FALSE,fig.height=5, fig.width=10}

load("/project/xinhe/xsun/mutation_rate/1.exp_obs_gnomad/data_processed/chr22/cv_ct_10kb.rdata")

combine <- merge(merged_sampled,merged_unsampled,by="window")
colnames(combine) <- c("window","sampled_sam","start_sam","end_sam","SNV_exp_sam","SNV_obs_sam","sampled_unsam","start_unsam","end_unsam","SNV_exp_unsam","SNV_obs_unsam")

eff_rand_sampled <- combine$SNV_obs_sam/combine$SNV_exp_sam

combine$SNV_pred_random <- combine$SNV_exp_unsam*eff_rand_sampled

# set up the 2x1 plot grid
par(mfrow=c(1,2))

# plot the first figure
plot(combine$SNV_pred_random, combine$SNV_obs_unsam, 
     xlab = "predicted_by_random_effect_testing_data", ylab = "observed_testing_data", 
     main = "Random Effect")
fit1 <- lm(combine$SNV_obs_unsam ~ combine$SNV_pred_random +0)
abline(fit1,col="red")
adj.rsq <-summary(fit1)$adj.r.squared
pval <- summary(fit1)$coefficients[,4]
print(paste0("Random Effect: the ajusted rsq is ",adj.rsq))
print(paste0("Random Effect: the fitting pvalue is ",pval))

# plot the second figure
plot(combine$SNV_exp_unsam, combine$SNV_obs_unsam, 
     xlab = "predicted_by_Roulette_testing_data", ylab = "observed_testing_data",
     main = "Roulette baseline")
fit2 <- lm(combine$SNV_obs_unsam ~ combine$SNV_exp_unsam +0)
abline(fit2,col="red")
adj.rsq <-summary(fit2)$adj.r.squared
pval <- summary(fit2)$coefficients[,4]
print(paste0("Roulette baseline: the ajusted rsq is ",adj.rsq))
print(paste0("Roulette baseline: the fitting pvalue is ",pval))

```