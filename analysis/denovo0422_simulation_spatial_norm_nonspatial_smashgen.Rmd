---
title: "Simulation -- combining spatial(normal prior) and non-spatial models, random effects estimated by smashgen"
author: "XSun"
date: "2024-05-06"
output:
  workflowr::wflow_html:
    code_folding: hide
    toc: true
---

# Introduction

## Simulation setup 

We combined the spatial and non-spatial models here

$y_i = \text{pois}(u_i\theta_i)$

where $u_i$ is expected rate from calibrated roulette. $y_i$ is the observed mutation rate. $\theta_i$ is the random effect.

1. Simulating the random effects

We simulated spatial random effects as we did in [spatial-only model](https://xsun1229.github.io/mutation_rate/denovo0422_simulation_spatial_norm.html) 
We simulated spatial random effects as we did in [non-spatial-only model](https://xsun1229.github.io/mutation_rate/denovo0422_simulation_nonspatial.html)

Then we multiply the spatial and non-spatial random effects, and normalized them, making $\text{mean}(\tilde\theta_i) =1$

```{r}

generate_randeff_nonspatial_gammaprior_spatial_normal <-  function(num_windows_all, num_windows_per_seg_min, num_windows_per_seg_max, randeff_max, num_seg_spatial,alpha,normal_sigma) {
  
  # Create the vector
  randeff <- rep(1,num_windows_all)
  
  #spatial
  segment_lengths_spatial <- ceiling(runif(num_seg_spatial, min = num_windows_per_seg_min, max = num_windows_per_seg_max))
  
  # Calculate the total length covered by spatial random effects
  total_segment_length <- sum(segment_lengths_spatial) 
  
  # Calculate the number of zeros needed
  num_zeros <- num_windows_all - total_segment_length
  
  # Randomly select positions for spatial segment starts 
  segment_starts_spatial <- sample(1:num_zeros, num_seg_spatial, replace = FALSE)
  segment_ends_spatial <- segment_starts_spatial + segment_lengths_spatial - 1
  
  # Assign random values to segments
  for (i in 1:(num_seg_spatial)) {
    start_pos <- segment_starts_spatial[i]
    end_pos <- start_pos + segment_lengths_spatial[i] - 1
    
    log_eff <- rnorm(1,mean = 0,sd=normal_sigma)
    eff <- exp(log_eff)
    randeff[start_pos:end_pos] <- eff
  }
  
  
  ## non-spatial
  alpha <- alpha
  randeff_nonspatial <- rgamma(n = num_windows_all, shape = alpha, rate = alpha)
  
  
  randeff <- randeff * randeff_nonspatial
  
  # Adjust values to meet the mean of 1
  mean_adjustment <- 1 - mean(randeff)
  randeff <- randeff + mean_adjustment
  # Clip values between 0 and randeff_max
  randeff[randeff < 0] <- 0
  #randeff[randeff > randeff_max] <- randeff_max
  
  
  return(randeff)
}

set.seed(2)
randeff <- generate_randeff_nonspatial_gammaprior_spatial_normal(num_windows_all = 3000,num_windows_per_seg_min = 20,num_windows_per_seg_max = 50,randeff_max = 3,num_seg_spatial = 10,alpha = 30,normal_sigma = 1)

plot(randeff,type = "l",ylab = "simulated random effect")
```

2. Then, we estimated $\hat\theta_i$ using smashgen

3. The results are compared with the estimation from [2steps method](https://xsun1229.github.io/mutation_rate/denovo0422_simulation_spatial_norm_nonspatial.html), [non-spatial method](https://xsun1229.github.io/mutation_rate/denovo0422_simulation_nonspatial.html), and [spatial smoothed method](https://xsun1229.github.io/mutation_rate/denovo0422_simulation_spatial_norm.html)

## Functions used

```{r}
library(ggplot2)
library(gridExtra)

process_data <- function(dat, smashgen_fit) {
  data <- dat[, c("y_sample", "spatial_effect", "roulette", "randeff_simulated", 
                  "randeff_est_sp_only", "exp_sp_only","randeff_est_sf_ns_final", "exp_sf_ns", "randeff_est_nsp_only", "exp_nsp_only")]
  colnames(data) <- c("y_sample", "spatial_effect", "roulette", "randeff_simulated", 
                      "randeff_smoothed", "exp_smoothed","randeff_2steps","exp_2steps","randeff_nsp_only","exp_nsp_only")
  data$randeff_posterior_mean <- smashgen_fit$posterior$mean
  data$exp_posterior_mean <- data$randeff_posterior_mean * data$roulette
  return(data)
}

plot_randeff_allwindows <- function(dat) {
  ggplot(dat, aes(x = seq_along(y_sample))) +
  geom_line(aes(y = randeff_simulated, color = "Simulated"), alpha = 0.5) +
  #geom_line(aes(y = randeff_est_sp_only, color = "Spatial-only")) +
  geom_line(aes(y = randeff_posterior_mean, color = "randeff_posterior_mean"), alpha = 0.6) +
  geom_line(aes(y = randeff_smoothed, color = "randeff_smoothed"), alpha = 0.6) +
  labs(x = "Window index",
       y = "estimated random effects") +
  scale_color_manual(name = "Group", 
                     values = c("Simulated" = "blue",
                                "randeff_posterior_mean" = "green", "randeff_smoothed" = "red"), 
                     labels = c("Simulated","randeff_posterior_mean", "randeff_smoothed")) +
  theme_minimal()
}

scatter_randeff <- function(data, estimate_column, title, alpha_est = NULL,colcol) {
  
  # Fit linear model
  formula <- as.formula(paste("randeff_simulated ~ ",estimate_column, "+0"))
  fit <- lm(formula, data = data)
  adj_rsq <- summary(fit)$adj.r.squared
  
  # Create the plot
  # p <- ggplot(data, aes(x = randeff_simulated, y = get(estimate_column))) +
  #   geom_point(color = "black") +
  #   geom_abline(intercept = 0, slope = 1, color = "red") +
  #   geom_text(aes(label = paste("Adj R-sq =", round(adj_rsq, 3))),
  #             x = Inf, y = -Inf, hjust = 1, vjust = -1, color = "blue") +
  #   labs(x = paste("Estimated random effect -", title),
  #        y = "True random effect theta_i",
  #        title = title) +
  #   theme_minimal()
  # 
  p <- ggplot(data) +
  geom_point(data = data[data[[colcol]] == "FALSE", ], aes(x = get(estimate_column) , y = randeff_simulated), 
             color = "black", alpha = 0.5) +
  geom_point(data = data[data[[colcol]] == "TRUE", ], aes(x = get(estimate_column) , y = randeff_simulated), 
             color = "red", alpha = 1) +  # Ensure red dots are on top
  geom_abline(intercept = 0, slope = 1, color = "red", linetype = "dashed") +
  annotate("text", x = Inf, y = Inf, label = paste0("Adj R-sq = ", round(adj_rsq, 3)),
           hjust = 1.1, vjust = 1.1, color = "blue", parse = FALSE) +  # Adjust text positioning and color
  labs(x = paste("Estimated random effect -", title),
       y = "True random effect theta_i",
       title = paste0(title," red: spatial effects")) +
  theme_minimal()
  
  # Add alpha_est text only if alpha_est is not NULL
  if (!is.null(alpha_est)) {
    p <- p + geom_text(aes(label = paste("alpha_est =", round(alpha_est, 3))),
                       x = Inf, y = -Inf, hjust = 1, vjust = -3, color = "blue")
  }
  
  return(p)
}

scatter_plot_mutct <- function(data, xcol, ycol, colcol, title=NULL) {
  # Fit the linear model using user-defined columns
  formula <- as.formula(paste(ycol, "~", xcol, "+0"))
  fit <- lm(formula, data = data)
  adj_rsq <- summary(fit)$adj.r.squared  # Extract the adjusted R-squared

  
  ggplot(data) +
  geom_point(data = data[data[[colcol]] == "FALSE", ], aes_string(x = xcol, y = ycol), 
             color = "black", alpha = 0.5) +
  geom_point(data = data[data[[colcol]] == "TRUE", ], aes_string(x = xcol, y = ycol), 
             color = "red", alpha = 1) +  # Ensure red dots are on top
  geom_abline(intercept = 0, slope = 1, color = "red", linetype = "dashed") +
  annotate("text", x = Inf, y = Inf, label = paste0("Adj R-sq = ", round(adj_rsq, 3)),
           hjust = 1.1, vjust = 1.1, color = "blue", parse = FALSE) +  # Adjust text positioning and color
  labs(x = paste("Predicted mutation count:", xcol),
       y = paste("True mutation count (sampled):", ycol),
       title = paste0(title," |red:spatial effects")) +
  #guides(color = guide_legend(title = "Mutation Flag")) +
  #scale_color_manual(values = c("FALSE" = "black", "TRUE" = "red"), 
  #                     name = "Spatial effects", labels = c("False", "True")) +
    
  theme_minimal()
  
}


```


# Summary 

```{r}
load("/project/xinhe/xsun/mutation_rate/9.denovo_simulation_0422/results/rsq_sum.rdata")
DT::datatable(rsq_all,caption = htmltools::tags$caption(style = 'caption-side: left; text-align: left; color:black; font-size:150%;','fitting rsq for all simulation settings'),options = list(pageLength = 10))
```

# 50kb 

## normal_var_spatial=0.5, alpha = 5, spatial window = 200kb ~ 1mb

```{r fig.width=16, fig.height=5}

load("/project/xinhe/xsun/mutation_rate/9.denovo_simulation_0422/results/spatial_nonspatial_sp_normal/simu_sp_nsp_chr1_50kb_maxiter50_normal_sigma0.5_alphansp_5_minseg4_maxseg20.rdata")

data <- process_data(dat = dat,smashgen_fit = fit_sp_only)

plot_randeff_allwindows(data)

p1 <- scatter_randeff(data = data, estimate_column = "randeff_posterior_mean", title = "posterior_mean|", colcol = "spatial_effect")
p2 <- scatter_randeff(data = data, estimate_column = "randeff_smoothed", title = "mean_smooth|", colcol = "spatial_effect")
p3 <- scatter_randeff(data = data, estimate_column = "randeff_2steps", title = "2steps|", colcol = "spatial_effect")
p4 <- scatter_randeff(data = data, estimate_column = "randeff_nsp_only", title = "non_spatial_only|", colcol = "spatial_effect")
grid.arrange(p1, p2,p3, p4, ncol = 4)


p1 <- scatter_plot_mutct(data = data, xcol = "exp_posterior_mean", ycol = "y_sample", title = "exp_posterior_mean",colcol = "spatial_effect")
p2 <- scatter_plot_mutct(data = data, xcol = "exp_smoothed", ycol = "y_sample", title = "exp_mean_smooth",colcol = "spatial_effect")
p3 <- scatter_plot_mutct(data = data, xcol = "exp_2steps", ycol = "y_sample", title = "exp_mean_2steps",colcol = "spatial_effect")
p4 <- scatter_plot_mutct(data = data, xcol = "exp_nsp_only", ycol = "y_sample", title = "exp_mean_nsp_only",colcol = "spatial_effect")
p5 <- scatter_plot_mutct(data = data, xcol = "roulette", ycol = "y_sample", title = "exp_roulette",colcol = "spatial_effect")

grid.arrange(p1, p2,p3, p4, p5, ncol = 5)

```


## normal_var_spatial=1, alpha = 5, spatial window = 200kb ~ 1mb

```{r fig.width=20, fig.height=5}

load("/project/xinhe/xsun/mutation_rate/9.denovo_simulation_0422/results/spatial_nonspatial_sp_normal/simu_sp_nsp_chr1_50kb_maxiter50_normal_sigma1_alphansp_5_minseg4_maxseg20.rdata")

data <- process_data(dat = dat,smashgen_fit = fit_sp_only)

plot_randeff_allwindows(data)

p1 <- scatter_randeff(data = data, estimate_column = "randeff_posterior_mean", title = "posterior_mean|", colcol = "spatial_effect")
p2 <- scatter_randeff(data = data, estimate_column = "randeff_smoothed", title = "mean_smooth|", colcol = "spatial_effect")
p3 <- scatter_randeff(data = data, estimate_column = "randeff_2steps", title = "2steps|", colcol = "spatial_effect")
p4 <- scatter_randeff(data = data, estimate_column = "randeff_nsp_only", title = "non_spatial_only|", colcol = "spatial_effect")
grid.arrange(p1, p2,p3, p4, ncol = 4)


p1 <- scatter_plot_mutct(data = data, xcol = "exp_posterior_mean", ycol = "y_sample", title = "exp_posterior_mean",colcol = "spatial_effect")
p2 <- scatter_plot_mutct(data = data, xcol = "exp_smoothed", ycol = "y_sample", title = "exp_mean_smooth",colcol = "spatial_effect")
p3 <- scatter_plot_mutct(data = data, xcol = "exp_2steps", ycol = "y_sample", title = "exp_mean_2steps",colcol = "spatial_effect")
p4 <- scatter_plot_mutct(data = data, xcol = "exp_nsp_only", ycol = "y_sample", title = "exp_mean_nsp_only",colcol = "spatial_effect")
p5 <- scatter_plot_mutct(data = data, xcol = "roulette", ycol = "y_sample", title = "exp_roulette",colcol = "spatial_effect")

grid.arrange(p1, p2,p3, p4, p5, ncol = 5)
```

## normal_var_spatial=0.5, alpha = 5, spatial window = 500kb ~ 1mb

```{r fig.width=20, fig.height=5}

load("/project/xinhe/xsun/mutation_rate/9.denovo_simulation_0422/results/spatial_nonspatial_sp_normal/simu_sp_nsp_chr1_50kb_maxiter50_normal_sigma0.5_alphansp_5_minseg10_maxseg20.rdata")

data <- process_data(dat = dat,smashgen_fit = fit_sp_only)

plot_randeff_allwindows(data)

p1 <- scatter_randeff(data = data, estimate_column = "randeff_posterior_mean", title = "posterior_mean|", colcol = "spatial_effect")
p2 <- scatter_randeff(data = data, estimate_column = "randeff_smoothed", title = "mean_smooth|", colcol = "spatial_effect")
p3 <- scatter_randeff(data = data, estimate_column = "randeff_2steps", title = "2steps|", colcol = "spatial_effect")
p4 <- scatter_randeff(data = data, estimate_column = "randeff_nsp_only", title = "non_spatial_only|", colcol = "spatial_effect")
grid.arrange(p1, p2,p3, p4, ncol = 4)


p1 <- scatter_plot_mutct(data = data, xcol = "exp_posterior_mean", ycol = "y_sample", title = "exp_posterior_mean",colcol = "spatial_effect")
p2 <- scatter_plot_mutct(data = data, xcol = "exp_smoothed", ycol = "y_sample", title = "exp_mean_smooth",colcol = "spatial_effect")
p3 <- scatter_plot_mutct(data = data, xcol = "exp_2steps", ycol = "y_sample", title = "exp_mean_2steps",colcol = "spatial_effect")
p4 <- scatter_plot_mutct(data = data, xcol = "exp_nsp_only", ycol = "y_sample", title = "exp_mean_nsp_only",colcol = "spatial_effect")
p5 <- scatter_plot_mutct(data = data, xcol = "roulette", ycol = "y_sample", title = "exp_roulette",colcol = "spatial_effect")

grid.arrange(p1, p2,p3, p4, p5, ncol = 5)
```


## normal_var_spatial=1, alpha = 5, spatial window = 500kb ~ 1mb

```{r fig.width=20, fig.height=5}

load("/project/xinhe/xsun/mutation_rate/9.denovo_simulation_0422/results/spatial_nonspatial_sp_normal/simu_sp_nsp_chr1_50kb_maxiter50_normal_sigma1_alphansp_5_minseg10_maxseg20.rdata")

data <- process_data(dat = dat,smashgen_fit = fit_sp_only)

plot_randeff_allwindows(data)

p1 <- scatter_randeff(data = data, estimate_column = "randeff_posterior_mean", title = "posterior_mean|", colcol = "spatial_effect")
p2 <- scatter_randeff(data = data, estimate_column = "randeff_smoothed", title = "mean_smooth|", colcol = "spatial_effect")
p3 <- scatter_randeff(data = data, estimate_column = "randeff_2steps", title = "2steps|", colcol = "spatial_effect")
p4 <- scatter_randeff(data = data, estimate_column = "randeff_nsp_only", title = "non_spatial_only|", colcol = "spatial_effect")
grid.arrange(p1, p2,p3, p4, ncol = 4)


p1 <- scatter_plot_mutct(data = data, xcol = "exp_posterior_mean", ycol = "y_sample", title = "exp_posterior_mean",colcol = "spatial_effect")
p2 <- scatter_plot_mutct(data = data, xcol = "exp_smoothed", ycol = "y_sample", title = "exp_mean_smooth",colcol = "spatial_effect")
p3 <- scatter_plot_mutct(data = data, xcol = "exp_2steps", ycol = "y_sample", title = "exp_mean_2steps",colcol = "spatial_effect")
p4 <- scatter_plot_mutct(data = data, xcol = "exp_nsp_only", ycol = "y_sample", title = "exp_mean_nsp_only",colcol = "spatial_effect")
p5 <- scatter_plot_mutct(data = data, xcol = "roulette", ycol = "y_sample", title = "exp_roulette",colcol = "spatial_effect")

grid.arrange(p1, p2,p3, p4, p5, ncol = 5)
```

## normal_var_spatial=0.5, alpha = 5, spatial window = 1mb ~ 2mb

```{r fig.width=20, fig.height=5}

load("/project/xinhe/xsun/mutation_rate/9.denovo_simulation_0422/results/spatial_nonspatial_sp_normal/simu_sp_nsp_chr1_50kb_maxiter50_normal_sigma0.5_alphansp_5_minseg20_maxseg40.rdata")

data <- process_data(dat = dat,smashgen_fit = fit_sp_only)

plot_randeff_allwindows(data)

p1 <- scatter_randeff(data = data, estimate_column = "randeff_posterior_mean", title = "posterior_mean|", colcol = "spatial_effect")
p2 <- scatter_randeff(data = data, estimate_column = "randeff_smoothed", title = "mean_smooth|", colcol = "spatial_effect")
p3 <- scatter_randeff(data = data, estimate_column = "randeff_2steps", title = "2steps|", colcol = "spatial_effect")
p4 <- scatter_randeff(data = data, estimate_column = "randeff_nsp_only", title = "non_spatial_only|", colcol = "spatial_effect")
grid.arrange(p1, p2,p3, p4, ncol = 4)


p1 <- scatter_plot_mutct(data = data, xcol = "exp_posterior_mean", ycol = "y_sample", title = "exp_posterior_mean",colcol = "spatial_effect")
p2 <- scatter_plot_mutct(data = data, xcol = "exp_smoothed", ycol = "y_sample", title = "exp_mean_smooth",colcol = "spatial_effect")
p3 <- scatter_plot_mutct(data = data, xcol = "exp_2steps", ycol = "y_sample", title = "exp_mean_2steps",colcol = "spatial_effect")
p4 <- scatter_plot_mutct(data = data, xcol = "exp_nsp_only", ycol = "y_sample", title = "exp_mean_nsp_only",colcol = "spatial_effect")
p5 <- scatter_plot_mutct(data = data, xcol = "roulette", ycol = "y_sample", title = "exp_roulette",colcol = "spatial_effect")

grid.arrange(p1, p2,p3, p4, p5, ncol = 5)
```


## normal_var_spatial=1, alpha = 5, spatial window = 1mb ~ 2mb

```{r fig.width=20, fig.height=5}

load("/project/xinhe/xsun/mutation_rate/9.denovo_simulation_0422/results/spatial_nonspatial_sp_normal/simu_sp_nsp_chr1_50kb_maxiter50_normal_sigma1_alphansp_5_minseg20_maxseg40.rdata")

data <- process_data(dat = dat,smashgen_fit = fit_sp_only)

plot_randeff_allwindows(data)

p1 <- scatter_randeff(data = data, estimate_column = "randeff_posterior_mean", title = "posterior_mean|", colcol = "spatial_effect")
p2 <- scatter_randeff(data = data, estimate_column = "randeff_smoothed", title = "mean_smooth|", colcol = "spatial_effect")
p3 <- scatter_randeff(data = data, estimate_column = "randeff_2steps", title = "2steps|", colcol = "spatial_effect")
p4 <- scatter_randeff(data = data, estimate_column = "randeff_nsp_only", title = "non_spatial_only|", colcol = "spatial_effect")
grid.arrange(p1, p2,p3, p4, ncol = 4)


p1 <- scatter_plot_mutct(data = data, xcol = "exp_posterior_mean", ycol = "y_sample", title = "exp_posterior_mean",colcol = "spatial_effect")
p2 <- scatter_plot_mutct(data = data, xcol = "exp_smoothed", ycol = "y_sample", title = "exp_mean_smooth",colcol = "spatial_effect")
p3 <- scatter_plot_mutct(data = data, xcol = "exp_2steps", ycol = "y_sample", title = "exp_mean_2steps",colcol = "spatial_effect")
p4 <- scatter_plot_mutct(data = data, xcol = "exp_nsp_only", ycol = "y_sample", title = "exp_mean_nsp_only",colcol = "spatial_effect")
p5 <- scatter_plot_mutct(data = data, xcol = "roulette", ycol = "y_sample", title = "exp_roulette",colcol = "spatial_effect")

grid.arrange(p1, p2,p3, p4, p5, ncol = 5)
```


## normal_var_spatial=0.5, alpha = 20, spatial window = 200kb ~ 1mb

```{r fig.width=20, fig.height=5}

load("/project/xinhe/xsun/mutation_rate/9.denovo_simulation_0422/results/spatial_nonspatial_sp_normal/simu_sp_nsp_chr1_50kb_maxiter50_normal_sigma0.5_alphansp_30_minseg4_maxseg20.rdata")

data <- process_data(dat = dat,smashgen_fit = fit_sp_only)

plot_randeff_allwindows(data)

p1 <- scatter_randeff(data = data, estimate_column = "randeff_posterior_mean", title = "posterior_mean|", colcol = "spatial_effect")
p2 <- scatter_randeff(data = data, estimate_column = "randeff_smoothed", title = "mean_smooth|", colcol = "spatial_effect")
p3 <- scatter_randeff(data = data, estimate_column = "randeff_2steps", title = "2steps|", colcol = "spatial_effect")
p4 <- scatter_randeff(data = data, estimate_column = "randeff_nsp_only", title = "non_spatial_only|", colcol = "spatial_effect")
grid.arrange(p1, p2,p3, p4, ncol = 4)


p1 <- scatter_plot_mutct(data = data, xcol = "exp_posterior_mean", ycol = "y_sample", title = "exp_posterior_mean",colcol = "spatial_effect")
p2 <- scatter_plot_mutct(data = data, xcol = "exp_smoothed", ycol = "y_sample", title = "exp_mean_smooth",colcol = "spatial_effect")
p3 <- scatter_plot_mutct(data = data, xcol = "exp_2steps", ycol = "y_sample", title = "exp_mean_2steps",colcol = "spatial_effect")
p4 <- scatter_plot_mutct(data = data, xcol = "exp_nsp_only", ycol = "y_sample", title = "exp_mean_nsp_only",colcol = "spatial_effect")
p5 <- scatter_plot_mutct(data = data, xcol = "roulette", ycol = "y_sample", title = "exp_roulette",colcol = "spatial_effect")

grid.arrange(p1, p2,p3, p4, p5, ncol = 5)
```


## normal_var_spatial=1, alpha = 20, spatial window = 200kb ~ 1mb

```{r fig.width=20, fig.height=5}

load("/project/xinhe/xsun/mutation_rate/9.denovo_simulation_0422/results/spatial_nonspatial_sp_normal/simu_sp_nsp_chr1_50kb_maxiter50_normal_sigma1_alphansp_30_minseg4_maxseg20.rdata")

data <- process_data(dat = dat,smashgen_fit = fit_sp_only)

plot_randeff_allwindows(data)

p1 <- scatter_randeff(data = data, estimate_column = "randeff_posterior_mean", title = "posterior_mean|", colcol = "spatial_effect")
p2 <- scatter_randeff(data = data, estimate_column = "randeff_smoothed", title = "mean_smooth|", colcol = "spatial_effect")
p3 <- scatter_randeff(data = data, estimate_column = "randeff_2steps", title = "2steps|", colcol = "spatial_effect")
p4 <- scatter_randeff(data = data, estimate_column = "randeff_nsp_only", title = "non_spatial_only|", colcol = "spatial_effect")
grid.arrange(p1, p2,p3, p4, ncol = 4)


p1 <- scatter_plot_mutct(data = data, xcol = "exp_posterior_mean", ycol = "y_sample", title = "exp_posterior_mean",colcol = "spatial_effect")
p2 <- scatter_plot_mutct(data = data, xcol = "exp_smoothed", ycol = "y_sample", title = "exp_mean_smooth",colcol = "spatial_effect")
p3 <- scatter_plot_mutct(data = data, xcol = "exp_2steps", ycol = "y_sample", title = "exp_mean_2steps",colcol = "spatial_effect")
p4 <- scatter_plot_mutct(data = data, xcol = "exp_nsp_only", ycol = "y_sample", title = "exp_mean_nsp_only",colcol = "spatial_effect")
p5 <- scatter_plot_mutct(data = data, xcol = "roulette", ycol = "y_sample", title = "exp_roulette",colcol = "spatial_effect")

grid.arrange(p1, p2,p3, p4, p5, ncol = 5)
```

## normal_var_spatial=0.5, alpha = 20, spatial window = 500kb ~ 1mb

```{r fig.width=20, fig.height=5}

load("/project/xinhe/xsun/mutation_rate/9.denovo_simulation_0422/results/spatial_nonspatial_sp_normal/simu_sp_nsp_chr1_50kb_maxiter50_normal_sigma0.5_alphansp_30_minseg10_maxseg20.rdata")

data <- process_data(dat = dat,smashgen_fit = fit_sp_only)

plot_randeff_allwindows(data)

p1 <- scatter_randeff(data = data, estimate_column = "randeff_posterior_mean", title = "posterior_mean|", colcol = "spatial_effect")
p2 <- scatter_randeff(data = data, estimate_column = "randeff_smoothed", title = "mean_smooth|", colcol = "spatial_effect")
p3 <- scatter_randeff(data = data, estimate_column = "randeff_2steps", title = "2steps|", colcol = "spatial_effect")
p4 <- scatter_randeff(data = data, estimate_column = "randeff_nsp_only", title = "non_spatial_only|", colcol = "spatial_effect")
grid.arrange(p1, p2,p3, p4, ncol = 4)


p1 <- scatter_plot_mutct(data = data, xcol = "exp_posterior_mean", ycol = "y_sample", title = "exp_posterior_mean",colcol = "spatial_effect")
p2 <- scatter_plot_mutct(data = data, xcol = "exp_smoothed", ycol = "y_sample", title = "exp_mean_smooth",colcol = "spatial_effect")
p3 <- scatter_plot_mutct(data = data, xcol = "exp_2steps", ycol = "y_sample", title = "exp_mean_2steps",colcol = "spatial_effect")
p4 <- scatter_plot_mutct(data = data, xcol = "exp_nsp_only", ycol = "y_sample", title = "exp_mean_nsp_only",colcol = "spatial_effect")
p5 <- scatter_plot_mutct(data = data, xcol = "roulette", ycol = "y_sample", title = "exp_roulette",colcol = "spatial_effect")

grid.arrange(p1, p2,p3, p4, p5, ncol = 5)
```


## normal_var_spatial=1, alpha = 20, spatial window = 500kb ~ 1mb

```{r fig.width=20, fig.height=5}

load("/project/xinhe/xsun/mutation_rate/9.denovo_simulation_0422/results/spatial_nonspatial_sp_normal/simu_sp_nsp_chr1_50kb_maxiter50_normal_sigma1_alphansp_30_minseg10_maxseg20.rdata")

data <- process_data(dat = dat,smashgen_fit = fit_sp_only)

plot_randeff_allwindows(data)

p1 <- scatter_randeff(data = data, estimate_column = "randeff_posterior_mean", title = "posterior_mean|", colcol = "spatial_effect")
p2 <- scatter_randeff(data = data, estimate_column = "randeff_smoothed", title = "mean_smooth|", colcol = "spatial_effect")
p3 <- scatter_randeff(data = data, estimate_column = "randeff_2steps", title = "2steps|", colcol = "spatial_effect")
p4 <- scatter_randeff(data = data, estimate_column = "randeff_nsp_only", title = "non_spatial_only|", colcol = "spatial_effect")
grid.arrange(p1, p2,p3, p4, ncol = 4)


p1 <- scatter_plot_mutct(data = data, xcol = "exp_posterior_mean", ycol = "y_sample", title = "exp_posterior_mean",colcol = "spatial_effect")
p2 <- scatter_plot_mutct(data = data, xcol = "exp_smoothed", ycol = "y_sample", title = "exp_mean_smooth",colcol = "spatial_effect")
p3 <- scatter_plot_mutct(data = data, xcol = "exp_2steps", ycol = "y_sample", title = "exp_mean_2steps",colcol = "spatial_effect")
p4 <- scatter_plot_mutct(data = data, xcol = "exp_nsp_only", ycol = "y_sample", title = "exp_mean_nsp_only",colcol = "spatial_effect")
p5 <- scatter_plot_mutct(data = data, xcol = "roulette", ycol = "y_sample", title = "exp_roulette",colcol = "spatial_effect")

grid.arrange(p1, p2,p3, p4, p5, ncol = 5)
```

## normal_var_spatial=0.5, alpha = 20, spatial window = 1mb ~ 2mb

```{r fig.width=20, fig.height=5}

load("/project/xinhe/xsun/mutation_rate/9.denovo_simulation_0422/results/spatial_nonspatial_sp_normal/simu_sp_nsp_chr1_50kb_maxiter50_normal_sigma0.5_alphansp_30_minseg20_maxseg40.rdata")

data <- process_data(dat = dat,smashgen_fit = fit_sp_only)

plot_randeff_allwindows(data)

p1 <- scatter_randeff(data = data, estimate_column = "randeff_posterior_mean", title = "posterior_mean|", colcol = "spatial_effect")
p2 <- scatter_randeff(data = data, estimate_column = "randeff_smoothed", title = "mean_smooth|", colcol = "spatial_effect")
p3 <- scatter_randeff(data = data, estimate_column = "randeff_2steps", title = "2steps|", colcol = "spatial_effect")
p4 <- scatter_randeff(data = data, estimate_column = "randeff_nsp_only", title = "non_spatial_only|", colcol = "spatial_effect")
grid.arrange(p1, p2,p3, p4, ncol = 4)


p1 <- scatter_plot_mutct(data = data, xcol = "exp_posterior_mean", ycol = "y_sample", title = "exp_posterior_mean",colcol = "spatial_effect")
p2 <- scatter_plot_mutct(data = data, xcol = "exp_smoothed", ycol = "y_sample", title = "exp_mean_smooth",colcol = "spatial_effect")
p3 <- scatter_plot_mutct(data = data, xcol = "exp_2steps", ycol = "y_sample", title = "exp_mean_2steps",colcol = "spatial_effect")
p4 <- scatter_plot_mutct(data = data, xcol = "exp_nsp_only", ycol = "y_sample", title = "exp_mean_nsp_only",colcol = "spatial_effect")
p5 <- scatter_plot_mutct(data = data, xcol = "roulette", ycol = "y_sample", title = "exp_roulette",colcol = "spatial_effect")

grid.arrange(p1, p2,p3, p4, p5, ncol = 5)
```


## normal_var_spatial=1, alpha = 20, spatial window = 1mb ~ 2mb

```{r fig.width=20, fig.height=5}

load("/project/xinhe/xsun/mutation_rate/9.denovo_simulation_0422/results/spatial_nonspatial_sp_normal/simu_sp_nsp_chr1_50kb_maxiter50_normal_sigma1_alphansp_30_minseg20_maxseg40.rdata")

data <- process_data(dat = dat,smashgen_fit = fit_sp_only)

plot_randeff_allwindows(data)

p1 <- scatter_randeff(data = data, estimate_column = "randeff_posterior_mean", title = "posterior_mean|", colcol = "spatial_effect")
p2 <- scatter_randeff(data = data, estimate_column = "randeff_smoothed", title = "mean_smooth|", colcol = "spatial_effect")
p3 <- scatter_randeff(data = data, estimate_column = "randeff_2steps", title = "2steps|", colcol = "spatial_effect")
p4 <- scatter_randeff(data = data, estimate_column = "randeff_nsp_only", title = "non_spatial_only|", colcol = "spatial_effect")
grid.arrange(p1, p2,p3, p4, ncol = 4)


p1 <- scatter_plot_mutct(data = data, xcol = "exp_posterior_mean", ycol = "y_sample", title = "exp_posterior_mean",colcol = "spatial_effect")
p2 <- scatter_plot_mutct(data = data, xcol = "exp_smoothed", ycol = "y_sample", title = "exp_mean_smooth",colcol = "spatial_effect")
p3 <- scatter_plot_mutct(data = data, xcol = "exp_2steps", ycol = "y_sample", title = "exp_mean_2steps",colcol = "spatial_effect")
p4 <- scatter_plot_mutct(data = data, xcol = "exp_nsp_only", ycol = "y_sample", title = "exp_mean_nsp_only",colcol = "spatial_effect")
p5 <- scatter_plot_mutct(data = data, xcol = "roulette", ycol = "y_sample", title = "exp_roulette",colcol = "spatial_effect")

grid.arrange(p1, p2,p3, p4, p5, ncol = 5)
```

# 10kb 
## normal_var_spatial=0.5, alpha = 5, spatial window = 100kb ~ 1mb

```{r fig.width=20, fig.height=5}

load("/project/xinhe/xsun/mutation_rate/9.denovo_simulation_0422/results/spatial_nonspatial_sp_normal/simu_sp_nsp_chr1_10kb_maxiter50_normal_sigma0.5_alphansp_5_minseg10_maxseg100.rdata")

data <- process_data(dat = dat,smashgen_fit = fit_sp_only)

plot_randeff_allwindows(data)

p1 <- scatter_randeff(data = data, estimate_column = "randeff_posterior_mean", title = "posterior_mean|", colcol = "spatial_effect")
p2 <- scatter_randeff(data = data, estimate_column = "randeff_smoothed", title = "mean_smooth|", colcol = "spatial_effect")
p3 <- scatter_randeff(data = data, estimate_column = "randeff_2steps", title = "2steps|", colcol = "spatial_effect")
p4 <- scatter_randeff(data = data, estimate_column = "randeff_nsp_only", title = "non_spatial_only|", colcol = "spatial_effect")
grid.arrange(p1, p2,p3, p4, ncol = 4)


p1 <- scatter_plot_mutct(data = data, xcol = "exp_posterior_mean", ycol = "y_sample", title = "exp_posterior_mean",colcol = "spatial_effect")
p2 <- scatter_plot_mutct(data = data, xcol = "exp_smoothed", ycol = "y_sample", title = "exp_mean_smooth",colcol = "spatial_effect")
p3 <- scatter_plot_mutct(data = data, xcol = "exp_2steps", ycol = "y_sample", title = "exp_mean_2steps",colcol = "spatial_effect")
p4 <- scatter_plot_mutct(data = data, xcol = "exp_nsp_only", ycol = "y_sample", title = "exp_mean_nsp_only",colcol = "spatial_effect")
p5 <- scatter_plot_mutct(data = data, xcol = "roulette", ycol = "y_sample", title = "exp_roulette",colcol = "spatial_effect")

grid.arrange(p1, p2,p3, p4, p5, ncol = 5)

```


## normal_var_spatial=1, alpha = 5, spatial window = 100kb ~ 1mb

```{r fig.width=20, fig.height=5}

load("/project/xinhe/xsun/mutation_rate/9.denovo_simulation_0422/results/spatial_nonspatial_sp_normal/simu_sp_nsp_chr1_10kb_maxiter50_normal_sigma1_alphansp_5_minseg10_maxseg100.rdata")

data <- process_data(dat = dat,smashgen_fit = fit_sp_only)

plot_randeff_allwindows(data)

p1 <- scatter_randeff(data = data, estimate_column = "randeff_posterior_mean", title = "posterior_mean|", colcol = "spatial_effect")
p2 <- scatter_randeff(data = data, estimate_column = "randeff_smoothed", title = "mean_smooth|", colcol = "spatial_effect")
p3 <- scatter_randeff(data = data, estimate_column = "randeff_2steps", title = "2steps|", colcol = "spatial_effect")
p4 <- scatter_randeff(data = data, estimate_column = "randeff_nsp_only", title = "non_spatial_only|", colcol = "spatial_effect")
grid.arrange(p1, p2,p3, p4, ncol = 4)


p1 <- scatter_plot_mutct(data = data, xcol = "exp_posterior_mean", ycol = "y_sample", title = "exp_posterior_mean",colcol = "spatial_effect")
p2 <- scatter_plot_mutct(data = data, xcol = "exp_smoothed", ycol = "y_sample", title = "exp_mean_smooth",colcol = "spatial_effect")
p3 <- scatter_plot_mutct(data = data, xcol = "exp_2steps", ycol = "y_sample", title = "exp_mean_2steps",colcol = "spatial_effect")
p4 <- scatter_plot_mutct(data = data, xcol = "exp_nsp_only", ycol = "y_sample", title = "exp_mean_nsp_only",colcol = "spatial_effect")
p5 <- scatter_plot_mutct(data = data, xcol = "roulette", ycol = "y_sample", title = "exp_roulette",colcol = "spatial_effect")

grid.arrange(p1, p2,p3, p4, p5, ncol = 5)
```



## normal_var_spatial=0.5, alpha = 30, spatial window = 100kb ~ 1mb

```{r fig.width=20, fig.height=5}

load("/project/xinhe/xsun/mutation_rate/9.denovo_simulation_0422/results/spatial_nonspatial_sp_normal/simu_sp_nsp_chr1_10kb_maxiter50_normal_sigma0.5_alphansp_30_minseg10_maxseg100.rdata")

data <- process_data(dat = dat,smashgen_fit = fit_sp_only)

plot_randeff_allwindows(data)

p1 <- scatter_randeff(data = data, estimate_column = "randeff_posterior_mean", title = "posterior_mean|", colcol = "spatial_effect")
p2 <- scatter_randeff(data = data, estimate_column = "randeff_smoothed", title = "mean_smooth|", colcol = "spatial_effect")
p3 <- scatter_randeff(data = data, estimate_column = "randeff_2steps", title = "2steps|", colcol = "spatial_effect")
p4 <- scatter_randeff(data = data, estimate_column = "randeff_nsp_only", title = "non_spatial_only|", colcol = "spatial_effect")
grid.arrange(p1, p2,p3, p4, ncol = 4)


p1 <- scatter_plot_mutct(data = data, xcol = "exp_posterior_mean", ycol = "y_sample", title = "exp_posterior_mean",colcol = "spatial_effect")
p2 <- scatter_plot_mutct(data = data, xcol = "exp_smoothed", ycol = "y_sample", title = "exp_mean_smooth",colcol = "spatial_effect")
p3 <- scatter_plot_mutct(data = data, xcol = "exp_2steps", ycol = "y_sample", title = "exp_mean_2steps",colcol = "spatial_effect")
p4 <- scatter_plot_mutct(data = data, xcol = "exp_nsp_only", ycol = "y_sample", title = "exp_mean_nsp_only",colcol = "spatial_effect")
p5 <- scatter_plot_mutct(data = data, xcol = "roulette", ycol = "y_sample", title = "exp_roulette",colcol = "spatial_effect")

grid.arrange(p1, p2,p3, p4, p5, ncol = 5)

```


## normal_var_spatial=1, alpha = 30, spatial window = 100kb ~ 1mb

```{r fig.width=20, fig.height=5}

load("/project/xinhe/xsun/mutation_rate/9.denovo_simulation_0422/results/spatial_nonspatial_sp_normal/simu_sp_nsp_chr1_10kb_maxiter50_normal_sigma1_alphansp_30_minseg10_maxseg100.rdata")


data <- process_data(dat = dat,smashgen_fit = fit_sp_only)

plot_randeff_allwindows(data)

p1 <- scatter_randeff(data = data, estimate_column = "randeff_posterior_mean", title = "posterior_mean|", colcol = "spatial_effect")
p2 <- scatter_randeff(data = data, estimate_column = "randeff_smoothed", title = "mean_smooth|", colcol = "spatial_effect")
p3 <- scatter_randeff(data = data, estimate_column = "randeff_2steps", title = "2steps|", colcol = "spatial_effect")
p4 <- scatter_randeff(data = data, estimate_column = "randeff_nsp_only", title = "non_spatial_only|", colcol = "spatial_effect")
grid.arrange(p1, p2,p3, p4, ncol = 4)


p1 <- scatter_plot_mutct(data = data, xcol = "exp_posterior_mean", ycol = "y_sample", title = "exp_posterior_mean",colcol = "spatial_effect")
p2 <- scatter_plot_mutct(data = data, xcol = "exp_smoothed", ycol = "y_sample", title = "exp_mean_smooth",colcol = "spatial_effect")
p3 <- scatter_plot_mutct(data = data, xcol = "exp_2steps", ycol = "y_sample", title = "exp_mean_2steps",colcol = "spatial_effect")
p4 <- scatter_plot_mutct(data = data, xcol = "exp_nsp_only", ycol = "y_sample", title = "exp_mean_nsp_only",colcol = "spatial_effect")
p5 <- scatter_plot_mutct(data = data, xcol = "roulette", ycol = "y_sample", title = "exp_roulette",colcol = "spatial_effect")

grid.arrange(p1, p2,p3, p4, p5, ncol = 5)
```


# 30kb 
## normal_var_spatial=0.5, alpha = 5, spatial window = 120kb ~ 900kb

```{r fig.width=20, fig.height=5}

load("/project/xinhe/xsun/mutation_rate/9.denovo_simulation_0422/results/spatial_nonspatial_sp_normal/simu_sp_nsp_chr1_30kb_maxiter50_normal_sigma0.5_alphansp_5_minseg4_maxseg30.rdata")

data <- process_data(dat = dat,smashgen_fit = fit_sp_only)

plot_randeff_allwindows(data)

p1 <- scatter_randeff(data = data, estimate_column = "randeff_posterior_mean", title = "posterior_mean|", colcol = "spatial_effect")
p2 <- scatter_randeff(data = data, estimate_column = "randeff_smoothed", title = "mean_smooth|", colcol = "spatial_effect")
p3 <- scatter_randeff(data = data, estimate_column = "randeff_2steps", title = "2steps|", colcol = "spatial_effect")
p4 <- scatter_randeff(data = data, estimate_column = "randeff_nsp_only", title = "non_spatial_only|", colcol = "spatial_effect")
grid.arrange(p1, p2,p3, p4, ncol = 4)


p1 <- scatter_plot_mutct(data = data, xcol = "exp_posterior_mean", ycol = "y_sample", title = "exp_posterior_mean",colcol = "spatial_effect")
p2 <- scatter_plot_mutct(data = data, xcol = "exp_smoothed", ycol = "y_sample", title = "exp_mean_smooth",colcol = "spatial_effect")
p3 <- scatter_plot_mutct(data = data, xcol = "exp_2steps", ycol = "y_sample", title = "exp_mean_2steps",colcol = "spatial_effect")
p4 <- scatter_plot_mutct(data = data, xcol = "exp_nsp_only", ycol = "y_sample", title = "exp_mean_nsp_only",colcol = "spatial_effect")
p5 <- scatter_plot_mutct(data = data, xcol = "roulette", ycol = "y_sample", title = "exp_roulette",colcol = "spatial_effect")

grid.arrange(p1, p2,p3, p4, p5, ncol = 5)

```

## normal_var_spatial=1, alpha = 5, spatial window = 120kb ~ 900kb

```{r fig.width=20, fig.height=5}

load("/project/xinhe/xsun/mutation_rate/9.denovo_simulation_0422/results/spatial_nonspatial_sp_normal/simu_sp_nsp_chr1_30kb_maxiter50_normal_sigma1_alphansp_5_minseg4_maxseg30.rdata")


data <- process_data(dat = dat,smashgen_fit = fit_sp_only)

plot_randeff_allwindows(data)

p1 <- scatter_randeff(data = data, estimate_column = "randeff_posterior_mean", title = "posterior_mean|", colcol = "spatial_effect")
p2 <- scatter_randeff(data = data, estimate_column = "randeff_smoothed", title = "mean_smooth|", colcol = "spatial_effect")
p3 <- scatter_randeff(data = data, estimate_column = "randeff_2steps", title = "2steps|", colcol = "spatial_effect")
p4 <- scatter_randeff(data = data, estimate_column = "randeff_nsp_only", title = "non_spatial_only|", colcol = "spatial_effect")
grid.arrange(p1, p2,p3, p4, ncol = 4)


p1 <- scatter_plot_mutct(data = data, xcol = "exp_posterior_mean", ycol = "y_sample", title = "exp_posterior_mean",colcol = "spatial_effect")
p2 <- scatter_plot_mutct(data = data, xcol = "exp_smoothed", ycol = "y_sample", title = "exp_mean_smooth",colcol = "spatial_effect")
p3 <- scatter_plot_mutct(data = data, xcol = "exp_2steps", ycol = "y_sample", title = "exp_mean_2steps",colcol = "spatial_effect")
p4 <- scatter_plot_mutct(data = data, xcol = "exp_nsp_only", ycol = "y_sample", title = "exp_mean_nsp_only",colcol = "spatial_effect")
p5 <- scatter_plot_mutct(data = data, xcol = "roulette", ycol = "y_sample", title = "exp_roulette",colcol = "spatial_effect")

grid.arrange(p1, p2,p3, p4, p5, ncol = 5)
```



## normal_var_spatial=0.5, alpha = 30, spatial window = 120kb ~ 900kb

```{r fig.width=20, fig.height=5}

load("/project/xinhe/xsun/mutation_rate/9.denovo_simulation_0422/results/spatial_nonspatial_sp_normal/simu_sp_nsp_chr1_30kb_maxiter50_normal_sigma0.5_alphansp_30_minseg4_maxseg30.rdata")


data <- process_data(dat = dat,smashgen_fit = fit_sp_only)

plot_randeff_allwindows(data)

p1 <- scatter_randeff(data = data, estimate_column = "randeff_posterior_mean", title = "posterior_mean|", colcol = "spatial_effect")
p2 <- scatter_randeff(data = data, estimate_column = "randeff_smoothed", title = "mean_smooth|", colcol = "spatial_effect")
p3 <- scatter_randeff(data = data, estimate_column = "randeff_2steps", title = "2steps|", colcol = "spatial_effect")
p4 <- scatter_randeff(data = data, estimate_column = "randeff_nsp_only", title = "non_spatial_only|", colcol = "spatial_effect")
grid.arrange(p1, p2,p3, p4, ncol = 4)


p1 <- scatter_plot_mutct(data = data, xcol = "exp_posterior_mean", ycol = "y_sample", title = "exp_posterior_mean",colcol = "spatial_effect")
p2 <- scatter_plot_mutct(data = data, xcol = "exp_smoothed", ycol = "y_sample", title = "exp_mean_smooth",colcol = "spatial_effect")
p3 <- scatter_plot_mutct(data = data, xcol = "exp_2steps", ycol = "y_sample", title = "exp_mean_2steps",colcol = "spatial_effect")
p4 <- scatter_plot_mutct(data = data, xcol = "exp_nsp_only", ycol = "y_sample", title = "exp_mean_nsp_only",colcol = "spatial_effect")
p5 <- scatter_plot_mutct(data = data, xcol = "roulette", ycol = "y_sample", title = "exp_roulette",colcol = "spatial_effect")

grid.arrange(p1, p2,p3, p4, p5, ncol = 5)

```


## normal_var_spatial=1, alpha = 30, spatial window = 120kb ~ 900kb

```{r fig.width=20, fig.height=5}

load("/project/xinhe/xsun/mutation_rate/9.denovo_simulation_0422/results/spatial_nonspatial_sp_normal/simu_sp_nsp_chr1_30kb_maxiter50_normal_sigma1_alphansp_30_minseg4_maxseg30.rdata")

data <- process_data(dat = dat,smashgen_fit = fit_sp_only)

plot_randeff_allwindows(data)

p1 <- scatter_randeff(data = data, estimate_column = "randeff_posterior_mean", title = "posterior_mean|", colcol = "spatial_effect")
p2 <- scatter_randeff(data = data, estimate_column = "randeff_smoothed", title = "mean_smooth|", colcol = "spatial_effect")
p3 <- scatter_randeff(data = data, estimate_column = "randeff_2steps", title = "2steps|", colcol = "spatial_effect")
p4 <- scatter_randeff(data = data, estimate_column = "randeff_nsp_only", title = "non_spatial_only|", colcol = "spatial_effect")
grid.arrange(p1, p2,p3, p4, ncol = 4)


p1 <- scatter_plot_mutct(data = data, xcol = "exp_posterior_mean", ycol = "y_sample", title = "exp_posterior_mean",colcol = "spatial_effect")
p2 <- scatter_plot_mutct(data = data, xcol = "exp_smoothed", ycol = "y_sample", title = "exp_mean_smooth",colcol = "spatial_effect")
p3 <- scatter_plot_mutct(data = data, xcol = "exp_2steps", ycol = "y_sample", title = "exp_mean_2steps",colcol = "spatial_effect")
p4 <- scatter_plot_mutct(data = data, xcol = "exp_nsp_only", ycol = "y_sample", title = "exp_mean_nsp_only",colcol = "spatial_effect")
p5 <- scatter_plot_mutct(data = data, xcol = "roulette", ycol = "y_sample", title = "exp_roulette",colcol = "spatial_effect")

grid.arrange(p1, p2,p3, p4, p5, ncol = 5)
```



# 100kb 
## normal_var_spatial=0.5, alpha = 5, spatial window = 100kb ~ 1mb

```{r fig.width=20, fig.height=5}

load("/project/xinhe/xsun/mutation_rate/9.denovo_simulation_0422/results/spatial_nonspatial_sp_normal/simu_sp_nsp_chr1_100kb_maxiter50_normal_sigma0.5_alphansp_5_minseg1_maxseg10.rdata")

data <- process_data(dat = dat,smashgen_fit = fit_sp_only)

plot_randeff_allwindows(data)

p1 <- scatter_randeff(data = data, estimate_column = "randeff_posterior_mean", title = "posterior_mean|", colcol = "spatial_effect")
p2 <- scatter_randeff(data = data, estimate_column = "randeff_smoothed", title = "mean_smooth|", colcol = "spatial_effect")
p3 <- scatter_randeff(data = data, estimate_column = "randeff_2steps", title = "2steps|", colcol = "spatial_effect")
p4 <- scatter_randeff(data = data, estimate_column = "randeff_nsp_only", title = "non_spatial_only|", colcol = "spatial_effect")
grid.arrange(p1, p2,p3, p4, ncol = 4)


p1 <- scatter_plot_mutct(data = data, xcol = "exp_posterior_mean", ycol = "y_sample", title = "exp_posterior_mean",colcol = "spatial_effect")
p2 <- scatter_plot_mutct(data = data, xcol = "exp_smoothed", ycol = "y_sample", title = "exp_mean_smooth",colcol = "spatial_effect")
p3 <- scatter_plot_mutct(data = data, xcol = "exp_2steps", ycol = "y_sample", title = "exp_mean_2steps",colcol = "spatial_effect")
p4 <- scatter_plot_mutct(data = data, xcol = "exp_nsp_only", ycol = "y_sample", title = "exp_mean_nsp_only",colcol = "spatial_effect")
p5 <- scatter_plot_mutct(data = data, xcol = "roulette", ycol = "y_sample", title = "exp_roulette",colcol = "spatial_effect")

grid.arrange(p1, p2,p3, p4, p5, ncol = 5)

```



## normal_var_spatial=0.5, alpha = 30, spatial window = 100kb ~ 1mb

```{r fig.width=20, fig.height=5}

load("/project/xinhe/xsun/mutation_rate/9.denovo_simulation_0422/results/spatial_nonspatial_sp_normal/simu_sp_nsp_chr1_100kb_maxiter50_normal_sigma0.5_alphansp_30_minseg1_maxseg10.rdata")

data <- process_data(dat = dat,smashgen_fit = fit_sp_only)

plot_randeff_allwindows(data)

p1 <- scatter_randeff(data = data, estimate_column = "randeff_posterior_mean", title = "posterior_mean|", colcol = "spatial_effect")
p2 <- scatter_randeff(data = data, estimate_column = "randeff_smoothed", title = "mean_smooth|", colcol = "spatial_effect")
p3 <- scatter_randeff(data = data, estimate_column = "randeff_2steps", title = "2steps|", colcol = "spatial_effect")
p4 <- scatter_randeff(data = data, estimate_column = "randeff_nsp_only", title = "non_spatial_only|", colcol = "spatial_effect")
grid.arrange(p1, p2,p3, p4, ncol = 4)


p1 <- scatter_plot_mutct(data = data, xcol = "exp_posterior_mean", ycol = "y_sample", title = "exp_posterior_mean",colcol = "spatial_effect")
p2 <- scatter_plot_mutct(data = data, xcol = "exp_smoothed", ycol = "y_sample", title = "exp_mean_smooth",colcol = "spatial_effect")
p3 <- scatter_plot_mutct(data = data, xcol = "exp_2steps", ycol = "y_sample", title = "exp_mean_2steps",colcol = "spatial_effect")
p4 <- scatter_plot_mutct(data = data, xcol = "exp_nsp_only", ycol = "y_sample", title = "exp_mean_nsp_only",colcol = "spatial_effect")
p5 <- scatter_plot_mutct(data = data, xcol = "roulette", ycol = "y_sample", title = "exp_roulette",colcol = "spatial_effect")

grid.arrange(p1, p2,p3, p4, p5, ncol = 5)

```


## normal_var_spatial=1, alpha = 30, spatial window = 100kb ~ 1mb

```{r fig.width=20, fig.height=5}

load("/project/xinhe/xsun/mutation_rate/9.denovo_simulation_0422/results/spatial_nonspatial_sp_normal/simu_sp_nsp_chr1_100kb_maxiter50_normal_sigma1_alphansp_30_minseg1_maxseg10.rdata")

data <- process_data(dat = dat,smashgen_fit = fit_sp_only)

plot_randeff_allwindows(data)

p1 <- scatter_randeff(data = data, estimate_column = "randeff_posterior_mean", title = "posterior_mean|", colcol = "spatial_effect")
p2 <- scatter_randeff(data = data, estimate_column = "randeff_smoothed", title = "mean_smooth|", colcol = "spatial_effect")
p3 <- scatter_randeff(data = data, estimate_column = "randeff_2steps", title = "2steps|", colcol = "spatial_effect")
p4 <- scatter_randeff(data = data, estimate_column = "randeff_nsp_only", title = "non_spatial_only|", colcol = "spatial_effect")
grid.arrange(p1, p2,p3, p4, ncol = 4)


p1 <- scatter_plot_mutct(data = data, xcol = "exp_posterior_mean", ycol = "y_sample", title = "exp_posterior_mean",colcol = "spatial_effect")
p2 <- scatter_plot_mutct(data = data, xcol = "exp_smoothed", ycol = "y_sample", title = "exp_mean_smooth",colcol = "spatial_effect")
p3 <- scatter_plot_mutct(data = data, xcol = "exp_2steps", ycol = "y_sample", title = "exp_mean_2steps",colcol = "spatial_effect")
p4 <- scatter_plot_mutct(data = data, xcol = "exp_nsp_only", ycol = "y_sample", title = "exp_mean_nsp_only",colcol = "spatial_effect")
p5 <- scatter_plot_mutct(data = data, xcol = "roulette", ycol = "y_sample", title = "exp_roulette",colcol = "spatial_effect")

grid.arrange(p1, p2,p3, p4, p5, ncol = 5)
```
